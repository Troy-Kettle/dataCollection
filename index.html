<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vital Signs Concern Levels</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS Styles -->
    <style>
        /* Global Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f9fc;
            color: #333;
            padding: 0;
            margin: 0;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
            margin: 40px 0 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }
        /* Vital Sign Styles */
        .vital-sign {
            background-color: #fff;
            border-radius: 8px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .vital-sign h3 {
            margin-top: 0;
            color: #3498db;
            font-size: 1.8em;
        }
        /* Scale Styles */
        .scale-container {
            position: relative;
            margin: 60px 0 40px 0;
            height: 100px; /* Adjusted to accommodate multiple arrow levels */
        }
        .track {
            position: relative;
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            margin: 30px 0;
            cursor: pointer;
        }
        .range {
            position: absolute;
            height: 12px;
            border-radius: 6px;
            top: 0;
        }
        .thumb {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            transform: translateX(-50%);
            cursor: pointer;
        }
        .thumb-normal {
            border-top: 18px solid #2ecc71; /* Green */
            top: -18px;
        }
        .thumb-mild {
            border-top: 18px solid #f1c40f; /* Yellow */
            top: -36px;
        }
        .thumb-moderate {
            border-top: 18px solid #e67e22; /* Orange */
            top: -54px;
        }
        .thumb-label {
            position: absolute;
            transform: translateX(-50%);
            font-size: 0.9em;
            white-space: nowrap;
            background: #fff;
            padding: 5px 8px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .thumb-label-normal {
            top: -75px;
        }
        .thumb-label-mild {
            top: -95px;
        }
        .thumb-label-moderate {
            top: -115px;
        }
        /* Tick Marks and Labels */
        .labels {
            position: absolute;
            width: 100%;
            top: 40px;
            font-size: 0.9em;
            pointer-events: none;
        }
        .labels span {
            position: absolute;
            transform: translateX(-50%);
            white-space: nowrap;
            color: #555;
        }
        .tick-marks {
            position: absolute;
            width: 100%;
            top: 8px;
            height: 16px;
            overflow: visible;
        }
        .tick {
            position: absolute;
            width: 2px;
            background: #999;
        }
        .tick.major {
            height: 16px;
        }
        .tick.minor {
            height: 10px;
        }
        /* Concern Levels */
        .concern-levels {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        .concern-level {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            color: #fff;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 1em;
            border-radius: 4px;
            margin: 0 5px;
            opacity: 1;
        }
        .no-concern { background-color: #2ecc71; }
        .mild-concern { background-color: #f1c40f; }
        .moderate-concern { background-color: #e67e22; }
        .severe-concern { background-color: #e74c3c; }
        /* Submit Button */
        #submitButton {
            display: block;
            margin: 60px auto;
            padding: 18px 36px;
            font-size: 1.2em;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #submitButton:hover {
            background-color: #2980b9;
        }
        /* Table Styles */
        .threshold-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 40px;
        }
        .threshold-table th, .threshold-table td {
            border: 1px solid #ccc;
            padding: 14px;
            text-align: left;
        }
        .threshold-table th {
            background-color: #f5f5f5;
            font-weight: 700;
        }
        /* Part 2 Styles */
        #part2Container {
            margin-top: 80px;
        }
        .combination {
            background-color: #fff;
            border-radius: 8px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .combination h3 {
            margin-top: 0;
            color: #3498db;
            font-size: 1.8em;
        }
        .combination-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 40px;
        }
        .combination-table th, .combination-table td {
            border: 1px solid #ccc;
            padding: 14px;
            text-align: left;
        }
        .combination-table th {
            background-color: #f5f5f5;
            font-weight: 700;
        }
        .slider-container {
            margin-top: 40px;
        }
        .slider-container label {
            display: block;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1em;
            color: #555;
        }
        .slider-container input[type="range"] {
            width: 100%;
        }
        .slider-container span {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            font-size: 1em;
            color: #333;
        }
        /* Part 3 Styles */
        #part3Container {
            margin-top: 80px;
        }
        .question-set {
            background-color: #fff;
            border-radius: 8px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        .question-set h3 {
            margin-top: 0;
            color: #3498db;
            font-size: 1.8em;
        }
        .question {
            margin-bottom: 25px;
        }
        .question label {
            display: block;
            margin-bottom: 10px;
            font-size: 1em;
            color: #555;
        }
        .question .slider-container {
            display: flex;
            align-items: center;
        }
        .question .slider-container input[type="range"] {
            flex: 1;
        }
        .question .slider-container span {
            margin-left: 10px;
            font-weight: bold;
        }
        /* Responsive Design */
        @media screen and (max-width: 768px) {
            .vital-sign, .question-set, .combination {
                padding: 30px;
            }
            .thumb-label {
                top: -50px;
            }
            .concern-levels {
                flex-direction: column;
            }
            .concern-level {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Vital Signs Concern Level Boundaries</h1>
        <div id="vitalSignsContainer"></div>

        <!-- Part 2: Combinations of Vital Signs -->
        <h2>Part 2: Combinations of Vital Signs</h2>
        <div id="part2Container"></div>

        <!-- Part 3: Further Interpretation of Vital Signs -->
        <h2>Part 3: Further Interpretation of Vital Signs</h2>
        <div id="part3Container"></div>

        <button id="submitButton">Submit</button>
    </div>

    <script>
        // Vital Signs Data
        const vitalSignsData = [
            {
                name: "Heart Rate",
                unit: "beats/min",
                min: 20,
                max: 200,
                step: 1,
                majorTick: 10,
                hasBothDirections: true
            },
            {
                name: "Systolic Blood Pressure",
                unit: "mmHg",
                min: 40,
                max: 250,
                step: 1,
                majorTick: 10,
                hasBothDirections: true
            },
            {
                name: "Respiratory Rate",
                unit: "breaths/min",
                min: 1,
                max: 60,
                step: 1,
                majorTick: 5,
                hasBothDirections: true
            },
            {
                name: "Temperature",
                unit: "℃",
                min: 32.0,
                max: 42.0,
                step: 0.1,
                majorTick: 1,
                hasBothDirections: true
            },
            {
                name: "Oxygen Saturation",
                unit: "%",
                min: 50,
                max: 100,
                step: 1,
                majorTick: 5,
                hasBothDirections: false,
                reverseScale: true
            }
        ];

        // Function to create vital sign elements
        function createVitalSignElement(vitalSign) {
            const container = document.createElement('div');
            container.className = 'vital-sign';

            const title = document.createElement('h3');
            title.textContent = `${vitalSign.name} (${vitalSign.unit})`;
            container.appendChild(title);

            const scaleContainer = document.createElement('div');
            scaleContainer.className = 'scale-container';
            container.appendChild(scaleContainer);

            const track = document.createElement('div');
            track.className = 'track';
            scaleContainer.appendChild(track);

            const ranges = [];
            const thumbs = [];
            const thumbLabels = [];

            const levels = getConcernLevels(vitalSign);

            const thresholds = [];
            const numArrows = getNumArrows(vitalSign);
            const min = vitalSign.min;
            const max = vitalSign.max;

            // Initialize thresholds at random positions but fully separated
            thresholds.push({ value: min }); // thresholds[0] - fixed
            const positions = getInitialPositions(numArrows, min, max, vitalSign.step);
            positions.forEach(pos => thresholds.push({ value: pos }));
            thresholds.push({ value: max }); // Last threshold - fixed

            // Add tick marks and labels
            addTickMarksAndLabels(scaleContainer, vitalSign);

            const concernLevelsContainer = document.createElement('div');
            concernLevelsContainer.className = 'concern-levels';
            levels.forEach(level => {
                const levelDiv = document.createElement('div');
                levelDiv.className = `concern-level ${level.class}`;
                levelDiv.textContent = level.label;
                concernLevelsContainer.appendChild(levelDiv);
            });
            container.appendChild(concernLevelsContainer);

            // Create table to display ranges
            const thresholdTable = document.createElement('table');
            thresholdTable.className = 'threshold-table';

            const tableHeader = document.createElement('thead');
            const headerRow = document.createElement('tr');

            const levelHeader = document.createElement('th');
            levelHeader.textContent = 'Concern Level';

            const lowerHeader = document.createElement('th');
            lowerHeader.textContent = 'Lower Limit';

            const upperHeader = document.createElement('th');
            upperHeader.textContent = 'Upper Limit';

            headerRow.appendChild(levelHeader);
            headerRow.appendChild(lowerHeader);
            headerRow.appendChild(upperHeader);
            tableHeader.appendChild(headerRow);
            thresholdTable.appendChild(tableHeader);

            const tableBody = document.createElement('tbody');
            thresholdTable.appendChild(tableBody);

            container.appendChild(thresholdTable);

            function createThumbs() {
                // Clear existing thumbs and ranges
                thumbs.forEach(thumb => thumb.remove());
                thumbLabels.forEach(label => label.remove());
                ranges.forEach(range => range.remove());
                thumbs.length = 0;
                thumbLabels.length = 0;
                ranges.length = 0;

                // Recreate thumbs and labels
                thresholds.forEach((threshold, index) => {
                    if (index > 0 && index < thresholds.length - 1) {
                        const level = getArrowLevel(index, vitalSign);
                        const thumb = document.createElement('div');
                        thumb.className = `thumb ${level.thumbClass}`;
                        thumb.dataset.index = index;
                        scaleContainer.appendChild(thumb);
                        thumbs.push(thumb);

                        // Create label for thumb
                        const thumbLabel = document.createElement('div');
                        thumbLabel.className = `thumb-label ${level.thumbLabelClass}`;
                        thumbLabel.textContent = formatValue(threshold.value, vitalSign);
                        scaleContainer.appendChild(thumbLabel);
                        thumbLabels.push(thumbLabel);

                        // Event listeners for thumb
                        let isDragging = false;
                        thumb.addEventListener('mousedown', e => {
                            isDragging = true;
                            document.addEventListener('mousemove', onMouseMove);
                            document.addEventListener('mouseup', onMouseUp);
                            e.preventDefault();
                        });

                        function onMouseMove(e) {
                            if (!isDragging) return;
                            const rect = track.getBoundingClientRect();
                            let offsetX = e.clientX - rect.left;
                            offsetX = Math.max(0, Math.min(offsetX, rect.width));
                            const percent = offsetX / rect.width;
                            let value = min + percent * (max - min);

                            // Snap to nearest step
                            value = Math.round(value / vitalSign.step) * vitalSign.step;
                            value = Math.max(min, Math.min(value, max));

                            const idx = parseInt(thumb.dataset.index);
                            thresholds[idx].value = value;
                            enforceBoundaries(idx);
                            updatePositions();
                        }

                        function onMouseUp() {
                            isDragging = false;
                            document.removeEventListener('mousemove', onMouseMove);
                            document.removeEventListener('mouseup', onMouseUp);
                        }
                    }
                });
            }

            function enforceBoundaries(index) {
                const threshold = thresholds[index];
                const prevValue = thresholds[index - 1]?.value;
                const nextValue = thresholds[index + 1]?.value;

                if (prevValue !== undefined && threshold.value <= prevValue) {
                    threshold.value = prevValue + vitalSign.step;
                }
                if (nextValue !== undefined && threshold.value >= nextValue) {
                    threshold.value = nextValue - vitalSign.step;
                }

                // Ensure normal range is at least one unit wide
                if (vitalSign.hasBothDirections && index >= 3 && index <= 4) {
                    if (thresholds[4].value - thresholds[3].value < vitalSign.step) {
                        if (index === 3) {
                            thresholds[3].value = thresholds[4].value - vitalSign.step;
                        } else {
                            thresholds[4].value = thresholds[3].value + vitalSign.step;
                        }
                    }
                }
            }

            function updatePositions() {
                // Update thumbs and labels
                thresholds.forEach((threshold, index) => {
                    if (index > 0 && index < thresholds.length - 1) {
                        const percent = ((threshold.value - min) / (max - min)) * 100;
                        const thumb = thumbs.find(t => parseInt(t.dataset.index) === index);
                        thumb.style.left = `${percent}%`;

                        // Update thumb label position and value
                        const thumbLabel = thumbLabels[thumbs.indexOf(thumb)];
                        thumbLabel.style.left = `${percent}%`;
                        thumbLabel.textContent = formatValue(threshold.value, vitalSign);
                        thumbLabel.style.display = 'block';
                    }
                });

                // Update ranges
                ranges.forEach((range, index) => {
                    const start = thresholds[index].value;
                    const end = thresholds[index + 1].value;
                    const startPercent = ((start - min) / (max - min)) * 100;
                    const endPercent = ((end - min) / (max - min)) * 100;
                    range.style.left = `${startPercent}%`;
                    range.style.width = `${endPercent - startPercent}%`;
                    range.style.backgroundColor = levels[index].color;
                });

                // Update the table
                updateThresholdTable();
            }

            function updateThresholdTable() {
                // Clear existing table rows
                tableBody.innerHTML = '';

                // For each range, create a table row
                for (let i = 0; i < levels.length; i++) {
                    const row = document.createElement('tr');
                    const levelCell = document.createElement('td');
                    levelCell.textContent = levels[i].label;

                    const lowerLimit = i === 0 ? '' : formatValue(thresholds[i].value, vitalSign);
                    const upperLimit = i === levels.length - 1 ? '' : formatValue(thresholds[i + 1].value, vitalSign);

                    const lowerCell = document.createElement('td');
                    lowerCell.textContent = lowerLimit;

                    const upperCell = document.createElement('td');
                    upperCell.textContent = upperLimit;

                    // If the range is eliminated (arrows overlapped), leave cells blank
                    if (lowerLimit === upperLimit) {
                        if (lowerLimit === '') {
                            lowerCell.textContent = '';
                            upperCell.textContent = '';
                        }
                    }

                    row.appendChild(levelCell);
                    row.appendChild(lowerCell);
                    row.appendChild(upperCell);
                    tableBody.appendChild(row);
                }
            }

            function addTickMarksAndLabels(scaleContainer, vitalSign) {
                const tickMarksContainer = document.createElement('div');
                tickMarksContainer.className = 'tick-marks';
                scaleContainer.appendChild(tickMarksContainer);

                const labelsContainer = document.createElement('div');
                labelsContainer.className = 'labels';
                scaleContainer.appendChild(labelsContainer);

                const min = vitalSign.min;
                const max = vitalSign.max;
                const step = vitalSign.step;
                const majorTick = vitalSign.majorTick;

                const totalSteps = Math.round((max - min) / step);

                // Add minor ticks
                for (let i = 0; i <= totalSteps; i++) {
                    const value = min + i * step;
                    const percent = ((value - min) / (max - min)) * 100;

                    const tick = document.createElement('div');
                    tick.className = 'tick';
                    tick.style.left = `${percent}%`;
                    tick.classList.add('minor');
                    tickMarksContainer.appendChild(tick);
                }

                // Add major ticks and labels
                let currentValue = min;

                // Adjust currentValue to the next multiple of majorTick
                currentValue = min + (majorTick - (min % majorTick)) % majorTick;

                while (currentValue <= max) {
                    const percent = ((currentValue - min) / (max - min)) * 100;

                    const tick = document.createElement('div');
                    tick.className = 'tick major';
                    tick.style.left = `${percent}%`;
                    tickMarksContainer.appendChild(tick);

                    const label = document.createElement('span');
                    label.textContent = formatValueForLabel(currentValue, vitalSign);
                    label.style.left = `${percent}%`;
                    labelsContainer.appendChild(label);

                    currentValue += majorTick;
                }

                // Add labels at min and max
                const minPercent = 0;
                const minLabel = document.createElement('span');
                minLabel.textContent = formatValueForLabel(min, vitalSign);
                minLabel.style.left = `${minPercent}%`;
                labelsContainer.appendChild(minLabel);

                const maxPercent = 100;
                const maxLabel = document.createElement('span');
                maxLabel.textContent = formatValueForLabel(max, vitalSign);
                maxLabel.style.left = `${maxPercent}%`;
                labelsContainer.appendChild(maxLabel);
            }

            function formatValue(value, vitalSign) {
                if (vitalSign.unit === '℃') {
                    return value.toFixed(1);
                } else if (vitalSign.unit === 'L/min') {
                    return value.toFixed(1);
                } else {
                    return Math.round(value);
                }
            }

            function formatValueForLabel(value, vitalSign) {
                return formatValue(value, vitalSign);
            }

            function getConcernLevels(vitalSign) {
                if (vitalSign.name === "Oxygen Saturation") {
                    return [
                        { label: 'Low - severe concern', class: 'severe-concern', color: '#e74c3c' },
                        { label: 'Low - moderate concern', class: 'moderate-concern', color: '#e67e22' },
                        { label: 'Low - mild concern', class: 'mild-concern', color: '#f1c40f' },
                        { label: 'No concern', class: 'no-concern', color: '#2ecc71' }
                    ];
                } else {
                    return [
                        { label: 'Low - severe concern', class: 'severe-concern', color: '#e74c3c' },
                        { label: 'Low - moderate concern', class: 'moderate-concern', color: '#e67e22' },
                        { label: 'Low - mild concern', class: 'mild-concern', color: '#f1c40f' },
                        { label: 'No concern', class: 'no-concern', color: '#2ecc71' },
                        { label: 'High - mild concern', class: 'mild-concern', color: '#f1c40f' },
                        { label: 'High - moderate concern', class: 'moderate-concern', color: '#e67e22' },
                        { label: 'High - severe concern', class: 'severe-concern', color: '#e74c3c' }
                    ];
                }
            }

            function getArrowLevel(index, vitalSign) {
                if (vitalSign.name === "Oxygen Saturation") {
                    switch (index) {
                        case 1:
                            return { thumbClass: 'thumb-moderate', thumbLabelClass: 'thumb-label-moderate' };
                        case 2:
                            return { thumbClass: 'thumb-mild', thumbLabelClass: 'thumb-label-mild' };
                        case 3:
                            return { thumbClass: 'thumb-normal', thumbLabelClass: 'thumb-label-normal' };
                        default:
                            return { thumbClass: '', thumbLabelClass: '' };
                    }
                } else {
                    switch (index) {
                        case 1:
                            return { thumbClass: 'thumb-moderate', thumbLabelClass: 'thumb-label-moderate' };
                        case 2:
                            return { thumbClass: 'thumb-mild', thumbLabelClass: 'thumb-label-mild' };
                        case 3:
                        case 4:
                            return { thumbClass: 'thumb-normal', thumbLabelClass: 'thumb-label-normal' };
                        case 5:
                            return { thumbClass: 'thumb-mild', thumbLabelClass: 'thumb-label-mild' };
                        case 6:
                            return { thumbClass: 'thumb-moderate', thumbLabelClass: 'thumb-label-moderate' };
                        default:
                            return { thumbClass: '', thumbLabelClass: '' };
                    }
                }
            }

            function getNumArrows(vitalSign) {
                if (vitalSign.name === "Oxygen Saturation") {
                    return 3; // thresholds[1] to thresholds[3]
                } else {
                    return 6; // thresholds[1] to thresholds[6]
                }
            }

            // Function to initialize arrows at random positions
            function getInitialPositions(numArrows, min, max, step) {
                const positions = [];
                const totalSteps = Math.floor((max - min) / step);
                const intervalSteps = Math.floor(totalSteps / (numArrows + 1));

                for (let i = 0; i < numArrows; i++) {
                    const minStep = i * intervalSteps;
                    const maxStep = (i + 1) * intervalSteps - 1;

                    const randomStep = minStep + Math.floor(Math.random() * (maxStep - minStep + 1));

                    positions.push(min + randomStep * step);
                }

                positions.sort((a, b) => a - b);

                return positions;
            }

            // Create ranges between thresholds
            for (let i = 0; i < thresholds.length - 1; i++) {
                const range = document.createElement('div');
                range.className = 'range';
                scaleContainer.appendChild(range);
                ranges.push(range);
            }

            vitalSign.getValues = function() {
                if (thresholds.length > 2) {
                    return thresholds.slice(1, -1).map(t => formatValue(t.value, vitalSign));
                } else {
                    return [];
                }
            };

            createThumbs();
            updatePositions();
            return container;
        }

        function collectData() {
            const data = {};
            data.thresholds = [];
            vitalSignsData.forEach(vitalSign => {
                const values = vitalSign.getValues();
                data.thresholds.push({
                    'Vital Sign': vitalSign.name,
                    'Unit': vitalSign.unit,
                    'Values': values.join(';')
                });
            });

            // Collect responses from Part 3
            const part3Responses = [];
            vitalSignsData.forEach(vitalSign => {
                const response = {
                    'Vital Sign': vitalSign.name,
                    'Questions': {}
                };
                part3Questions.forEach(question => {
                    const sliderInput = document.querySelector(`input[name="${vitalSign.name}-${question}"]`);
                    response['Questions'][question] = sliderInput.value;
                });
                part3Responses.push(response);
            });
            data.part3Responses = part3Responses;

            // Collect ratings from Part 2
            const part2Ratings = combinations.map((combination, index) => {
                const sliderInput = document.querySelector(`input[name="combination-${index}"]`);
                const rating = sliderInput.value;
                return {
                    'Combination': index + 1,
                    'Rating': rating
                };
            });
            data.part2Ratings = part2Ratings;

            return data;
        }

        function downloadCSV(data) {
            let csvContent = 'data:text/csv;charset=utf-8,';
            csvContent += 'Vital Sign,Unit,Thresholds\n';
            data.thresholds.forEach(row => {
                csvContent += `${row['Vital Sign']},${row['Unit']},${row['Values']}\n`;
            });

            // Add Part 3 responses
            csvContent += '\nPart 3 Responses\n';
            data.part3Responses.forEach(response => {
                csvContent += `Vital Sign: ${response['Vital Sign']}\n`;
                Object.keys(response['Questions']).forEach(question => {
                    csvContent += `${question},${response['Questions'][question]}\n`;
                });
                csvContent += '\n';
            });

            // Add Part 2 ratings
            csvContent += '\nPart 2 Ratings\n';
            csvContent += 'Combination,Rating\n';
            data.part2Ratings.forEach(row => {
                csvContent += `${row['Combination']},${row['Rating']}\n`;
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'vital_signs_data.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        const vitalSignsContainer = document.getElementById('vitalSignsContainer');

        vitalSignsData.forEach(vitalSign => {
            const vitalSignElement = createVitalSignElement(vitalSign);
            vitalSignsContainer.appendChild(vitalSignElement);
        });

        // Part 3 Questions (previously Part 2)
        const part3Questions = [
            "What is normal for that individual patient.",
            "Whether the general trend is worsening or improving",
            "Whether the abnormality has developed suddenly or gradually"
        ];

        // Create Part 3 Section (Further Interpretation)
        const part3Container = document.getElementById('part3Container');

        vitalSignsData.forEach(vitalSign => {
            const questionSet = document.createElement('div');
            questionSet.className = 'question-set';

            const title = document.createElement('h3');
            title.textContent = `When interpreting ${vitalSign.name}, how often do you take into account:`;
            questionSet.appendChild(title);

            part3Questions.forEach(questionText => {
                const question = document.createElement('div');
                question.className = 'question';

                const label = document.createElement('label');
                label.textContent = questionText;
                label.setAttribute('for', `${vitalSign.name}-${questionText}`);
                question.appendChild(label);

                // Create slider
                const sliderContainer = document.createElement('div');
                sliderContainer.className = 'slider-container';

                const sliderInput = document.createElement('input');
                sliderInput.type = 'range';
                sliderInput.min = 0;
                sliderInput.max = 10;
                sliderInput.value = 5;
                sliderInput.name = `${vitalSign.name}-${questionText}`;
                sliderContainer.appendChild(sliderInput);

                const sliderValueDisplay = document.createElement('span');
                sliderValueDisplay.textContent = '5';
                sliderContainer.appendChild(sliderValueDisplay);

                sliderInput.addEventListener('input', () => {
                    sliderValueDisplay.textContent = sliderInput.value;
                });

                question.appendChild(sliderContainer);
                questionSet.appendChild(question);
            });

            part3Container.appendChild(questionSet);
        });

        // Part 2: Combinations of vital signs (previously Part 3)
        const combinations = [
            {'Heart Rate': { value: 105, abnormal: true }, 'Blood Pressure': { value: '100/60', abnormal: true }, 'Respiratory Rate': { value: 18, abnormal: false }, 'Temperature': { value: 36.5, abnormal: false }, 'Oxygen Saturation': { value: 98, abnormal: false }},
            {'Heart Rate': { value: 105, abnormal: true }, 'Blood Pressure': { value: '135/80', abnormal: false }, 'Respiratory Rate': { value: 22, abnormal: true }, 'Temperature': { value: 36.5, abnormal: false }, 'Oxygen Saturation': { value: 98, abnormal: false }},
            {'Heart Rate': { value: 105, abnormal: true }, 'Blood Pressure': { value: '135/80', abnormal: false }, 'Respiratory Rate': { value: 18, abnormal: false }, 'Temperature': { value: 38.1, abnormal: true }, 'Oxygen Saturation': { value: 98, abnormal: false }},
            {'Heart Rate': { value: 105, abnormal: true }, 'Blood Pressure': { value: '135/80', abnormal: false }, 'Respiratory Rate': { value: 18, abnormal: false }, 'Temperature': { value: 36.5, abnormal: false }, 'Oxygen Saturation': { value: 94, abnormal: true }},
            {'Heart Rate': { value: 75, abnormal: false }, 'Blood Pressure': { value: '100/60', abnormal: true }, 'Respiratory Rate': { value: 22, abnormal: true }, 'Temperature': { value: 36.5, abnormal: false }, 'Oxygen Saturation': { value: 98, abnormal: false }},
            {'Heart Rate': { value: 75, abnormal: false }, 'Blood Pressure': { value: '100/60', abnormal: true }, 'Respiratory Rate': { value: 18, abnormal: false }, 'Temperature': { value: 38.1, abnormal: true }, 'Oxygen Saturation': { value: 98, abnormal: false }},
            {'Heart Rate': { value: 75, abnormal: false }, 'Blood Pressure': { value: '100/60', abnormal: true }, 'Respiratory Rate': { value: 18, abnormal: false }, 'Temperature': { value: 36.5, abnormal: false }, 'Oxygen Saturation': { value: 94, abnormal: true }},
            {'Heart Rate': { value: 75, abnormal: false }, 'Blood Pressure': { value: '135/80', abnormal: false }, 'Respiratory Rate': { value: 22, abnormal: true }, 'Temperature': { value: 38.1, abnormal: true }, 'Oxygen Saturation': { value: 98, abnormal: false }},
            {'Heart Rate': { value: 75, abnormal: false }, 'Blood Pressure': { value: '135/80', abnormal: false }, 'Respiratory Rate': { value: 22, abnormal: true }, 'Temperature': { value: 36.5, abnormal: false }, 'Oxygen Saturation': { value: 94, abnormal: true }},
            {'Heart Rate': { value: 75, abnormal: false }, 'Blood Pressure': { value: '135/80', abnormal: false }, 'Respiratory Rate': { value: 18, abnormal: false }, 'Temperature': { value: 38.1, abnormal: true }, 'Oxygen Saturation': { value: 94, abnormal: true }}
        ];

        function createCombinationElement(combination, index) {
            const container = document.createElement('div');
            container.className = 'combination';

            const title = document.createElement('h3');
            title.textContent = `Combination ${index + 1}`;
            container.appendChild(title);

            const table = document.createElement('table');
            table.className = 'combination-table';
            const tbody = document.createElement('tbody');

            Object.keys(combination).forEach(vitalSignName => {
                const vitalSignData = combination[vitalSignName];
                const value = vitalSignData.value;
                const isAbnormal = vitalSignData.abnormal;

                const tr = document.createElement('tr');

                const tdVitalSign = document.createElement('td');
                tdVitalSign.textContent = vitalSignName;
                tr.appendChild(tdVitalSign);

                const tdValue = document.createElement('td');
                tdValue.textContent = value;
                if (isAbnormal) {
                    tdValue.style.color = '#e74c3c';
                    tdValue.style.fontWeight = 'bold';
                }
                tr.appendChild(tdValue);

                tbody.appendChild(tr);
            });

            table.appendChild(tbody);
            container.appendChild(table);

            // Slider for rating (0 to 10)
            const sliderContainer = document.createElement('div');
            sliderContainer.className = 'slider-container';

            const sliderLabel = document.createElement('label');
            sliderLabel.textContent = 'Rate your level of concern (0 = No Concern, 10 = Extreme Concern):';
            sliderContainer.appendChild(sliderLabel);

            const sliderInput = document.createElement('input');
            sliderInput.type = 'range';
            sliderInput.min = 0;
            sliderInput.max = 10;
            sliderInput.value = 5;
            sliderInput.step = 0.1;
            sliderInput.name = `combination-${index}`;
            sliderContainer.appendChild(sliderInput);

            const sliderValueDisplay = document.createElement('span');
            sliderValueDisplay.textContent = '5';
            sliderContainer.appendChild(sliderValueDisplay);

            sliderInput.addEventListener('input', () => {
                sliderValueDisplay.textContent = sliderInput.value;
            });

            container.appendChild(sliderContainer);

            return container;
        }

        const part2Container = document.getElementById('part2Container');

        combinations.forEach((combination, index) => {
            const combinationElement = createCombinationElement(combination, index);
            part2Container.appendChild(combinationElement);
        });

        const submitButton = document.getElementById('submitButton');
        submitButton.addEventListener('click', () => {
            const data = collectData();
            downloadCSV(data);
        });
    </script>
</body>
</html>